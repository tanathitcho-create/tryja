<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Wi-Fi Heatmap ‚Äî Survey / Planning</title>
<style>
  :root{ --bg:#0f1220; --panel:#171a2b; --muted:#9aa4b2; --text:#e8ecf1;
         --card:#1b2035; --btn:#232845; --ring:#2a7fff55; --danger:#ff7b7b; }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:linear-gradient(120deg,#0f1220,#0e1428 60%,#0f1220);
       color:var(--text);font:500 16px/1.45 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  header{padding:12px 16px;border-bottom:1px solid #202540;background:rgba(17,22,36,.7);
         position:sticky;top:0;backdrop-filter:blur(8px);z-index:50;display:flex;align-items:center;gap:10px}
  header h1{margin:0;font-size:18px;flex:1}
  .mode-switch{display:flex;gap:6px}
  .pill{padding:6px 10px;border-radius:999px;border:1px solid #2a3156;background:#1a1f39;color:#cfd6ff;cursor:pointer}
  .pill.active{background:#2a3569;border-color:#3d4c9a;color:#fff;box-shadow:0 0 0 2px var(--ring)}
  .container{display:grid;grid-template-columns:380px 1fr;gap:14px;padding:14px;height:calc(100% - 56px)}
  .panel{background:var(--panel);border:1px solid #242a49;border-radius:14px;padding:14px;overflow:auto}
  .section{margin-bottom:14px;padding-bottom:12px;border-bottom:1px dashed #2a3156}
  .section:last-child{border-bottom:0;margin-bottom:0;padding-bottom:0}
  .label{font-size:13px;color:var(--muted);margin:6px 0 6px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  input[type="file"],input[type="number"],input[type="text"],select{
    background:var(--card);border:1px solid #2a3156;color:var(--text);
    border-radius:10px;padding:8px 10px;outline:none
  }
  input[type="number"]{width:120px}
  button{background:var(--btn);border:1px solid #2a3156;color:var(--text);padding:9px 12px;border-radius:11px;
         cursor:pointer;transition:.15s;user-select:none}
  button:hover{transform:translateY(-1px);box-shadow:0 6px 18px -10px #000,0 0 0 2px var(--ring)}
  button.danger{background:#3a1b1b;border-color:#5a2a2a;color:#ffc6c6}
  .chip{font-size:12px;border:1px solid #2a3156;border-radius:999px;padding:4px 9px;color:#9aa4b2;display:inline-flex;gap:6px;align-items:center}
  .legend{display:flex;align-items:center;gap:10px}
  .grad{width:220px;height:12px;border-radius:999px;border:1px solid #2a3156}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
  .kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:#222846;border:1px solid #2a3156;border-radius:6px;padding:2px 6px;color:#b9c3ff;font-size:12px}
  .muted{color:var(--muted)} .badge{font-size:12px;padding:4px 8px;border-radius:999px;background:#22284a;border:1px solid #2a3156}
  .small{font-size:12px}
  .apRow,.matRow{display:flex;justify-content:space-between;gap:8px;align-items:center;background:#141a34;border:1px solid #2a3156;border-radius:10px;padding:6px 8px}
  .dot{width:10px;height:10px;border-radius:50%}
  @media (max-width:980px){ .container{grid-template-columns:1fr} }

  /* canvases stack */
  .stage{position:relative;display:inline-block;overflow:hidden;border-radius:12px;border:1px solid #242a49}
  #canvas,#overlay{display:block}
  #overlay{position:absolute; left:0; top:0; pointer-events:none; z-index:3;}

  /* probe tooltip */
  #probe{position:absolute;display:none;transform:translate(10px,-10px);
         background:#0e1329;border:1px solid #2a3156;border-radius:10px;padding:6px 8px;
         color:#e8ecf1;font:600 13px ui-monospace,monospace;pointer-events:none;z-index:4;
         box-shadow:0 6px 20px rgba(0,0,0,.35)}
  #probe .sw{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px;border:1px solid #0006}
  #probe .sub{font-weight:500;color:#9aa4b2;margin-top:2px}

  /* Survey placeholder */
  .surveyBlank{background:#ffffff;border-radius:12px;border:1px dashed #cccccc; min-height:300px;
    display:flex;align-items:center;justify-content:center;color:#333;font:600 18px/1.3 ui-sans-serif,system-ui}
  .zoombar{display:flex;gap:6px}
</style>
</head>
<body>
<header>
  <h1>‡πÅ‡∏õ‡πâ‡∏á‡πÇ‡∏ä‡πÑ‡∏ß‡πÑ‡∏ü888</h1>
  <div class="mode-switch">
    <div class="pill active" id="pillPlanning">Planning</div>
    <div class="pill" id="pillSurvey">Survey</div>
  </div>
</header>

<!-- Planning -->
<div class="container" id="appPlanning" style="display:grid">
  <aside class="panel">
    <div class="section">
      <div class="label">1) ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏õ‡∏•‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (PNG/JPG)</div>
      <div class="row">
        <input type="file" id="fileInput" accept="image/*"/>
        <button id="btnClear">‡∏•‡πâ‡∏≤‡∏á</button>
      </div>
      <div class="row" style="margin-top:6px;justify-content:space-between">
        <div class="small muted">‡πÉ‡∏ä‡πâ‡∏•‡πâ‡∏≠‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ã‡∏π‡∏° ‚Ä¢ Space+‡∏•‡∏≤‡∏Å = ‡πÅ‡∏û‡∏ô ‚Ä¢ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ß‡∏¥‡∏ß</div>
        <div class="zoombar">
          <button id="btnZoomOut">‚àí</button>
          <button id="btnZoomReset">100%</button>
          <button id="btnZoomIn">+</button>
        </div>
      </div>
    </div>

    <div class="section">
      <div class="label">2) ‡∏ï‡∏±‡πâ‡∏á‡∏™‡πÄ‡∏Å‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏à‡∏£‡∏¥‡∏á</div>
      <div class="row">
        <button id="btnScale">üß≠ ‡∏ï‡∏±‡πâ‡∏á‡∏™‡πÄ‡∏Å‡∏• (‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‚Äì‡∏•‡∏≤‡∏Å‚Äì‡∏õ‡∏•‡πà‡∏≠‡∏¢)</button>
        <button id="btnIdle">üñ±Ô∏è ‡πÄ‡∏°‡πâ‡∏≤‡∏™‡πå‡∏õ‡∏Å‡∏ï‡∏¥</button>
        <span class="chip">‡∏™‡πÄ‡∏Å‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span id="scaleLabel">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á</span></span>
      </div>
      <div class="small muted">‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡∏≠‡∏±‡∏ï‡∏£‡∏≤ px/‡πÄ‡∏°‡∏ï‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏à‡∏≤‡∏Å AP ‚Üí ‡∏ó‡∏∏‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î</div>
    </div>

    <div class="section">
      <div class="label">3) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Access Point</div>
      <div class="row">
        <select id="apPreset" style="min-width:220px"><option value="">(‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï...)</option></select>
        <button id="btnUsePreset">‡πÉ‡∏ä‡πâ‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
      </div>
      <div class="small muted">‡πÑ‡∏ü‡∏•‡πå <code>ap_presets.json</code> ‡∏ó‡∏µ‡πà‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</div>
    </div>

    <div class="section">
      <div class="label">4) ‡∏ß‡∏≤‡∏á Access Point</div>
      <div class="grid">
        <div>
          <div class="label">‡∏ä‡∏∑‡πà‡∏≠/SSID</div>
          <input type="text" id="apLabel" placeholder="‡πÄ‡∏ä‡πà‡∏ô AP-1"/>
        </div>
        <div>
          <div class="label">P‚ÇÄ @1 m (‡∏îBm)</div>
          <input type="number" id="apP0" value="-40" step="1"/>
        </div>
        <div>
          <div class="label">‡∏¢‡πà‡∏≤‡∏ô</div>
          <select id="apBand"><option value="2.4">2.4 GHz</option><option value="5" selected>5 GHz</option></select>
        </div>
      </div>
      <div class="row" style="margin-top:8px">
        <button id="btnAP">üì° ‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏≤‡∏á AP (‡∏Ñ‡∏•‡∏¥‡∏Å)</button>
        <button id="btnAPUndo" class="ghost">‚Ü©Ô∏è ‡∏•‡∏ö AP ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
        <button id="btnAPClear" class="danger">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á AP ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      </div>
      <div id="apList" style="margin-top:10px;display:grid;gap:6px;"></div>
      <div class="small muted">‡∏´‡∏•‡∏≤‡∏¢ AP ‡πÑ‡∏î‡πâ ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏ß‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á (mW) ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô dBm</div>
    </div>

    <div class="section">
      <div class="label">5) ‡∏ß‡∏±‡∏™‡∏î‡∏∏/‡∏™‡∏¥‡πà‡∏á‡∏Å‡∏µ‡∏î‡∏Ç‡∏ß‡∏≤‡∏á</div>
      <div class="grid">
        <div>
          <div class="label">‡∏ä‡∏ô‡∏¥‡∏î‡∏ß‡∏±‡∏™‡∏î‡∏∏</div>
          <select id="matType"></select>
        </div>
        <div>
          <div class="label">‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏î‡∏Å‡∏•‡∏∑‡∏ô (dB/‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</div>
          <input type="number" id="matAtt" value="8" step="0.5"/>
        </div>
      </div>
      <div class="row" style="margin-top:8px">
        <button id="btnMat">üß± ‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏±‡∏™‡∏î‡∏∏ (‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‚Äì‡∏•‡∏≤‡∏Å‚Äì‡∏õ‡∏•‡πà‡∏≠‡∏¢)</button>
        <button id="btnMatUndo" class="ghost">‚Ü©Ô∏è ‡∏•‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
        <button id="btnMatClear" class="danger">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      </div>
      <div id="matList" style="margin-top:10px;display:grid;gap:6px;"></div>
    </div>

    <div class="section">
      <div class="label">6) ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå</div>
      <div class="grid">
        <div>
          <div class="label">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô Blur (px)</div>
          <input type="number" id="blurPx" value="16" min="0" step="1"/>
        </div>
        <div>
          <div class="label">‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™‡∏Æ‡∏µ‡∏ï‡πÅ‡∏°‡∏õ</div>
          <input type="number" id="alpha" value="0.6" min="0" max="1" step="0.05"/>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="btnRender">üî• ‡∏™‡∏£‡πâ‡∏≤‡∏á Heatmap</button>
        <button id="btnExport">üñºÔ∏è ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å PNG</button>
      </div>
      <div class="legend" style="margin-top:10px">
        <div id="grad" class="grad"></div>
        <div class="small"><span id="legendMin">-80</span> dBm ‚ü∑ <span id="legendMax">-50</span> dBm</div>
      </div>
      <div class="small muted">‡∏™‡∏µ: ‚â§‚àí67 ‡πÄ‡∏ó‡∏≤ (‡∏≠‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏ñ‡∏∂‡∏á ‚àí80) ‚Ä¢ ‚àí60 ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á ‚Ä¢ ‚àí30 ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß ‚Ä¢ ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≤‡∏ß‡∏ó‡∏∏‡∏Å ‚àí5 dBm (‚àí20..‚àí80)</div>
    </div>

    <div class="section">
      <div class="label">7) ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå</div>
      <div class="row">
        <button id="btnSave">üíæ Save JSON</button>
        <input type="file" id="loadJson" accept="application/json"/>
      </div>
    </div>

    <!-- ===== 8) Fractal (‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á Heatmap) ===== -->
    <div class="section">
      <div class="label">8) Fractal (‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á Heatmap ‡πÅ‡∏•‡πâ‡∏ß)</div>
      <div class="row" style="margin-top:8px">
        <button id="btnFDContour">üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì FD (Contour)</button>
        <button id="btnFDDBC">üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì FD (DBC)</button>
        <button id="btnFDReset">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü</button>
      </div>
      <div class="small muted" style="margin-top:6px">
        Contour = ‡∏à‡∏≤‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏Ñ‡∏≠‡∏ô‡∏ó‡∏±‡∏ß‡∏£‡πå RSSI | DBC = ‡∏à‡∏≤‡∏Å Heatmap ‡πÅ‡∏ö‡∏ö‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡∏£‡∏¢‡πå‡∏™‡πÄ‡∏Å‡∏•
      </div>
      <canvas id="fdPlot" width="360" height="240"
              style="margin-top:10px;border:1px solid #2a3156;border-radius:10px;background:#0b1124"></canvas>
      <div id="fdResult" class="small" style="margin-top:8px;color:#cfe6ff">
        (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ‚Äî ‡∏Å‡∏î ‚Äúüî• ‡∏™‡∏£‡πâ‡∏≤‡∏á Heatmap‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∂‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì)
      </div>
    </div>

    <div class="section small muted">
      ‡∏Ñ‡∏µ‡∏¢‡πå‡∏•‡∏±‡∏î: <span class="kbd">S</span> ‡∏™‡πÄ‡∏Å‡∏• ‚Ä¢ <span class="kbd">A</span> ‡∏ß‡∏≤‡∏á AP ‚Ä¢ <span class="kbd">W</span> ‡∏ß‡∏±‡∏™‡∏î‡∏∏ ‚Ä¢ <span class="kbd">H</span> ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå ‚Ä¢ <span class="kbd">Esc</span> ‡πÄ‡∏°‡πâ‡∏≤‡∏™‡πå‡∏õ‡∏Å‡∏ï‡∏¥ ‚Ä¢ ‡∏•‡πâ‡∏≠‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ã‡∏π‡∏° ‚Ä¢ Space+‡∏•‡∏≤‡∏Å = ‡πÅ‡∏û‡∏ô
    </div>
  </aside>

  <main class="panel">
    <div class="row">
      <span class="badge" id="modeBadge">‡πÇ‡∏´‡∏°‡∏î: Idle</span>
      <span class="muted small">‡∏™‡πÄ‡∏Å‡∏•/‡∏ß‡∏±‡∏™‡∏î‡∏∏ = ‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‚Äì‡∏•‡∏≤‡∏Å‚Äì‡∏õ‡∏•‡πà‡∏≠‡∏¢ | AP = ‡∏Ñ‡∏•‡∏¥‡∏Å | Probe = ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå</span>
    </div>

    <div class="stage" id="stage">
      <canvas id="canvas" width="1280" height="800"></canvas>
      <canvas id="overlay" width="1280" height="800"></canvas>
      <div id="probe">
        <div><span class="sw" id="sw"></span><span id="probeVal">‚Äì dBm</span></div>
        <div class="sub" id="probeMeta"></div>
      </div>
    </div>
  </main>
</div>

<!-- Survey (placeholder) -->
<div class="container" id="appSurvey" style="display:none;grid-template-columns:1fr">
  <main class="panel" style="display:flex;flex-direction:column;gap:12px">
    <div class="row">
      <span class="badge">‡πÇ‡∏´‡∏°‡∏î: Survey (Placeholder)</span>
      <span class="muted small">‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠</span>
    </div>
    <div class="surveyBlank">Survey Mode ‚Äî Blank Canvas</div>
  </main>
</div>

<!-- ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å + ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå Fractal -->
<script src="./app.js"></script>
<script src="./fd.js"></script>
</body>
</html>
